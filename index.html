<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Decorapro · Cotizador Distribuidores</title>
  <link rel="icon" href="./assets/logo-verde.png" />
  <style>
    /* PALETA DECORAPRO */
    :root{
      --verde:#7CB342; /* toma el verde del logo */
      --bg:#0c0c0e;    /* fondo oscuro elegante */
      --card:#141417;
      --text:#F7F7F7;
      --muted:#C9C9C9;
      --borders:#2a2a2e;
    }
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:var(--bg);color:var(--text)}
    header{padding:18px 0;background:linear-gradient(180deg,#111, #0c0c0e);border-bottom:1px solid #1e1e22}
    .wrap{max-width:980px;margin:0 auto;padding:0 20px}
    .brand{display:flex;gap:14px;align-items:center}
    .brand img{height:46px;width:auto;display:block}
    .brand h1{margin:0;font-size:1.25rem;font-weight:800;letter-spacing:.2px}
    .brand small{display:block;color:var(--muted);font-weight:500}
    .badge{display:inline-block;padding:4px 10px;border-radius:999px;background:#1e1e23;color:#d8d8d8;font-size:.8rem;margin-right:8px}
    .muted{color:var(--muted)}
    .card{background:var(--card);border-radius:14px;padding:18px;margin:16px 0;box-shadow:0 10px 30px rgba(0,0,0,.25);border:1px solid var(--borders)}
    label{display:block;margin:10px 0 6px;color:var(--muted);font-size:.95rem}
    select,input[type="number"]{width:100%;padding:12px 14px;border-radius:10px;border:1px solid var(--borders);background:#101013;color:#fff}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:720px){.row{grid-template-columns:1fr}}
    .legend{font-size:.92rem;color:#d8d8d8;margin-bottom:8px}
    .small{font-size:.86rem}
    .warn{background:#292116;border-left:4px solid #f2a900;padding:10px;border-radius:8px}
    .btn{display:inline-block;padding:12px 18px;border-radius:10px;background:var(--verde);color:#1b1b1b;font-weight:800;text-decoration:none;border:0}
    .btn:disabled{opacity:.5;cursor:not-allowed}
    .total{font-size:1.8rem;font-weight:900}
    footer{padding:16px 0;text-align:center;border-top:1px solid #1e1e22}
  </style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="brand">
      <img src="./assets/logo-verde.png" alt="Decorapro" />
      <div>
        <h1>Decorapro · Cotizador Distribuidores</h1>
        <small>Confecciones · Telas · Cortineros · Motorización</small>
      </div>
    </div>
    <div id="vigencia" class="muted" style="margin-top:8px"></div>
  </div>
</header>
  <div class="wrap">
    <h1>Decorapro · Cotizador Distribuidores</h1>
    <div class="muted">Cortinas · Precios orientados a distribuidores · IVA incluido</div>
    <div id="vigencia" class="muted" style="margin-top:8px;"></div>
  </div>
</header>

<main class="wrap">
  <div class="card">
    <div class="muted">Selecciona confección, modelo (tela), medidas y extras. Si la altura excede la permitida del modelo, te daremos un precio aproximado y te sugeriremos asesoría.</div>
  </div>

  <div class="card">
    <div class="row">
      <div>
        <label>Confección</label>
        <select id="confeccion"></select>
      </div>
      <div>
        <label>Modelo / Tela</label>
        <select id="modelo"></select>
      </div>
    </div>

    <div class="row">
      <div>
        <label>Ancho (m) · entero 1–6</label>
        <select id="ancho">
          <option value="1">1</option><option value="2">2</option>
          <option value="3">3</option><option value="4">4</option>
          <option value="5">5</option><option value="6">6</option>
        </select>
      </div>
      <div>
        <label>Altura (m)</label>
        <input id="alto" type="number" min="1" step="0.01" value="2.40" />
      </div>
    </div>
  </div>

  <div class="card">
    <div class="legend">Cortinero (precio por metro lineal · usa el ancho elegido)</div>
    <div class="row">
      <div>
        <label>Tipo de cortinero</label>
        <select id="cortinero">
          <option value="">— Sin cortinero —</option>
        </select>
      </div>
      <div>
        <label>Color</label>
        <select id="color">
          <option value="">— N/A —</option>
          <option>Blanco</option>
          <option>Negro</option>
        </select>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="legend">Motorización (precio por pieza) + extras opcionales</div>
    <div class="row">
      <div>
        <label>Riel motorizado</label>
        <select id="motorizacion">
          <option value="">— Sin motorización —</option>
        </select>
      </div>
      <div>
        <label>Extras</label>
        <div class="grid3">
          <label class="small"><input type="checkbox" class="extra" value="vti_hub"> Vti Smart Hub (+$1,100)</label>
          <label class="small"><input type="checkbox" class="extra" value="hub_plus"> Vti Smart Hub Plus (+$3,000)</label>
          <label class="small"><input type="checkbox" class="extra" value="charger"> Cargador (+$300)</label>
        </div>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="legend">Accesorios (por pieza)</div>
    <div class="grid3">
      <div class="fieldset">
        <div>Bracket noche/día</div>
        <input type="number" min="0" value="0" id="acc_bracket" /> <span class="small muted">pzas · $70</span>
      </div>
      <div class="fieldset">
        <div>Splice / empalme</div>
        <input type="number" min="0" value="0" id="acc_splice" /> <span class="small muted">pzas · $85</span>
      </div>
      <div class="fieldset">
        <div>Codo 90°</div>
        <input type="number" min="0" value="0" id="acc_codo" /> <span class="small muted">pzas · $900</span>
      </div>
    </div>
  </div>

  <div class="card">
    <div id="alerta" class="warn" style="display:none;"></div>
    <div class="row">
      <div>
        <div class="muted">Desglose</div>
        <div id="desglose" class="small"></div>
      </div>
      <div>
        <div class="muted">Total estimado</div>
        <div class="total" id="total">$0.00</div>
        <a id="wa" class="btn" href="#" target="_blank" rel="noopener">Enviar a WhatsApp</a>
      </div>
    </div>
  </div>

  <div class="card muted small">
    Precios de referencia. El precio final se calcula con el cotizador y tiene variaciones por decimales (no saltos cada metro). IVA incluido. Mínimo a cobrar 1×1 m por cortina.
  </div>
</main>

<footer>
  <div class="wrap">
    <span class="badge">Decorapro</span>
    <span class="badge">Vertical Art</span>
    <span class="badge">Distribuidores</span>
  </div>
</footer>
<script>
const $ = s => document.querySelector(s);
const confeSel = $('#confeccion'), modSel = $('#modelo'), anchoSel = $('#ancho'), altoInp = $('#alto');
const cortSel = $('#cortinero'), colorSel = $('#color'), motSel = $('#motorizacion');
const accB = $('#acc_bracket'), accS = $('#acc_splice'), accC = $('#acc_codo');
const desgloseEl = $('#desglose'), totalEl = $('#total'), alertaEl = $('#alerta'), waBtn = $('#wa');

let DATA = null;

(async function init(){
  const r = await fetch('./data/prices.json'); 
  DATA = await r.json();

  // Vigencia auto (último día del mes)
  (function setVigencia(){
    const d = new Date(), y=d.getFullYear(), m=d.getMonth()+1;
    const last = new Date(y, m, 0).getDate();
    document.querySelector('#vigencia').textContent =
      `Vigencia: ${last}/${String(m).padStart(2,'0')}/${y} · Se actualiza automáticamente cada mes.`;
  })();

  // Poblar selects
  DATA.confecciones.forEach(c => {
    const o = document.createElement('option'); o.value=c.id; o.textContent=c.nombre; confeSel.appendChild(o);
  });
  DATA.cortineros.forEach(c => {
    const o = document.createElement('option'); o.value=c.id; o.textContent=`${c.nombre} ($${c.precio_ml}/ml)`; cortSel.appendChild(o);
  });
  DATA.motorizacion.forEach(m => {
    const o = document.createElement('option'); o.value=m.id; o.textContent=`${m.nombre} ($${m.precio_pieza})`; motSel.appendChild(o);
  });

  confeSel.addEventListener('change', loadModelos);
  [modSel, anchoSel, altoInp, cortSel, colorSel, motSel, accB, accS, accC, ...document.querySelectorAll('.extra')].forEach(el => el.addEventListener('change', calc));

  loadModelos();
})();

function loadModelos(){
  modSel.innerHTML='';
  const c = DATA.confecciones.find(x=>x.id===confeSel.value) || DATA.confecciones[0];
  (c.modelos||[]).forEach(m=>{
    const o=document.createElement('option'); o.value=m.id; o.textContent=`${m.nombre} (Alt máx ${m.altura_max} m)`; modSel.appendChild(o);
  });
  calc();
}

function money(n){ return '$' + (Math.round(n*100)/100).toLocaleString('es-MX'); }

function calc(){
  const c = DATA.confecciones.find(x=>x.id===confeSel.value) || DATA.confecciones[0];
  const m = (c.modelos||[]).find(x=>x.id===modSel.value) || (c.modelos||[])[0];
  const ancho = Math.max(1, parseInt(anchoSel.value||'1',10)); // 1–6 m fijos
  const alto  = Math.max(1, parseFloat(altoInp.value||'1'));

  let base = m.precios_ancho[String(ancho)] ?? m.precios_ancho["6"];
  let alerta = '';
  let aproximado = false;
  if(alto > m.altura_max){
    aproximado = true;
    alerta = `La altura (${alto} m) excede la altura máxima (${m.altura_max} m). Mostramos precio aproximado. Requiere asesoría personalizada.`;
  }

  // Cortinero por ML
  let cortTotal = 0;
  if(cortSel.value){
    const cor = DATA.cortineros.find(x=>x.id===cortSel.value);
    if(cor){ cortTotal = cor.precio_ml * ancho; }
  }

  // Motorización + hubs/controles opcionales
  let motTotal = 0;
  if(motSel.value){
    const mo = DATA.motorizacion.find(x=>x.id===motSel.value);
    if(mo){ motTotal += mo.precio_pieza; }
    document.querySelectorAll('.extra:checked').forEach(ch=>{
      const ex = DATA.hubs_controles.find(x=>x.id===ch.value);
      if(ex) motTotal += ex.precio;
    });
  }

  // Accesorios por cantidad
  const acc = DATA.accesorios.reduce((acc, a)=>{ acc[a.id]=a.precio; return acc; },{});
  const accTotal = (parseInt(accB.value||0,10)*(acc['bracket_noche_dia']||0))
                 + (parseInt(accS.value||0,10)*(acc['splice_empalme']||0))
                 + (parseInt(accC.value||0,10)*(acc['codo_90']||0));

  const total = base + cortTotal + motTotal + accTotal;

  alertaEl.style.display = alerta ? 'block' : 'none';
  alertaEl.textContent = alerta;
  desgloseEl.innerHTML = `
    Base: <b>${money(base)}</b><br/>
    Cortinero: <b>${money(cortTotal)}</b><br/>
    Motorización+extras: <b>${money(motTotal)}</b><br/>
    Accesorios: <b>${money(accTotal)}</b><br/>
    ${aproximado ? '<span class="muted">* Precio aproximado por exceder altura máxima</span>' : ''}
  `;
  totalEl.textContent = money(total);

  const tel = (DATA.whatsapp || '').replace(/[^\d]/g,'') || '5215579022386';
  const txt = encodeURIComponent(
`Hola Decorapro, quiero este pedido:
Confección: ${c?.nombre}
Modelo/tela: ${m?.nombre}
Medidas: ${ancho} m (ancho) × ${alto} m (alto)
Cortinero: ${cortSel.options[cortSel.selectedIndex]?.text || 'N/A'} ${colorSel.value?('· '+colorSel.value):''}
Motorización: ${motSel.options[motSel.selectedIndex]?.text || 'N/A'}
Accesorios: Bracket ${document.querySelector('#acc_bracket').value}, Splice ${document.querySelector('#acc_splice').value}, Codo90 ${document.querySelector('#acc_codo').value}
Total: ${money(total)} ${aproximado ? '(aprox.)' : ''}`
  );
  document.querySelector('#wa').href = `https://wa.me/${tel}?text=${txt}`;
}
</script>
</body>
</html>
